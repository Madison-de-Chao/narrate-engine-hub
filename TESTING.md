# 八字排盤引擎｜日柱模組回歸測試報告 v2.4.2

## 版本資訊

| 項目 | 值 |
|------|-----|
| 版本 | v2.4.2 |
| 日柱算法 | `cycleIndex = (JDN + K) mod 60` |
| 校準常數 | K = 49 |
| 子時跨日 | 23:00–00:59 視為「次日」 |
| 甲子序列 | GANZHI[0]=甲子 … GANZHI[59]=癸亥（已驗證） |
| 錨點 | 1985-09-22 = 甲子（JDN=2446331） |

## 回歸門檻（Release Gate）

- **日柱回歸測試**：必須 12/12 通過
- **權威樣本回歸**：必須 3/3 通過
- **若任一失敗**：禁止部署；必須回溯 JDN/rawMod60/K/cycleIndex/targetDateAdjusted debug

---

## 1) 權威樣本（3/3）

| 案例 | 日期時間 | 預期 index | 預期日柱 | 實際日柱 | 結果 |
|------|----------|------------|----------|----------|------|
| A1 | 1985-10-06 | 14 | 戊寅 | 戊寅 | ✅ PASS |
| A2 | 2000-01-01 | 54 | 戊午 | 戊午 | ✅ PASS |
| A3 | 1990-09-27 | 31 | 乙未 | 乙未 | ✅ PASS |

---

## 2) 邊界測試（9/9）

| # | 類別 | 日期時間 | 預期日柱 | 實際日柱 | 結果 |
|---|------|----------|----------|----------|------|
| 1 | 立春換年 | 1984-02-04 23:00 | 己巳 | 己巳 | ✅ PASS |
| 2 | 子時跨日A | 1994-10-31 23:10 | 辛卯 | 辛卯 | ✅ PASS |
| 3 | 子時跨日B | 1994-11-01 00:40 | 辛卯 | 辛卯 | ✅ PASS |
| 4 | 戌時邊界 | 1990-05-15 19:30 | 庚辰 | 庚辰 | ✅ PASS |
| 5 | 亥時邊界 | 1990-05-15 21:10 | 庚辰 | 庚辰 | ✅ PASS |
| 6 | 寒露前 | 1994-10-08 06:00 | 丁卯 | 丁卯 | ✅ PASS |
| 7 | 寒露後 | 1994-10-09 10:00 | 戊辰 | 戊辰 | ✅ PASS |
| 8 | 小寒前 | 1990-01-05 06:00 | 庚午 | 庚午 | ✅ PASS |
| 9 | 小寒後 | 1990-01-05 23:00 | 辛未 | 辛未 | ✅ PASS |

---

## 判斷結論

- **v2.4.2 日柱模組回歸測試：12/12 PASS**
- 子時跨日、節氣邊界、跨年與時辰邊界皆符合既定口徑
- 可進入下一階段：四柱全回歸（年/月/時柱）與衍生層（十神/神煞/五行）

---

## Debug 欄位標準

每筆測試需輸出：

```
jdnTarget, rawJDNMod60, calibrationK, cycleIndex, computedDayGanzhi
targetDateOriginal, targetDateAdjusted, ziHourNextDayRule
```

---

## 保護欄（CI Guard）

在測試初始化時必須驗證：

1. `K === 49`（或 `profile === "SPEC_K49"`）
2. `GANZHI_60[0] === "甲子"` 且 `GANZHI_60.length === 60`

這會杜絕未來有人改設定或改表，造成「測試仍綠但世界線不同」的事故。

---

## 下一階段測試清單

### Level A：四柱一致性（不含納音/十神/神煞）

1. **年柱（立春分年）**：已在 1984-02-04 23:00 覆蓋
2. **月柱（節氣分月）**：寒露前後、小寒前後已覆蓋
3. **時柱（五鼠遁 + 時支）**：戌/亥邊界已覆蓋

### Level B：衍生層（納音、五行、十神、神煞）

| 項目 | 定義範圍 | 版本標記 |
|------|----------|----------|
| 納音 | 完全查表（NAYIN map） | v1.0 |
| 五行分數 | 干 1.0、支 0.8、藏干（本氣 0.6/中氣 0.4/餘氣 0.3） | v1.0 |
| 十神 | 以日干為主，五行生剋＋陰陽判斷 | v1.0 |
| 神煞 | 傳統版 20 個 / 軍團版 34 個 | trad v1.0 / legion v1.0 |

---

## 版本歷史

| 版本 | 日期 | 變更 |
|------|------|------|
| v2.4.2 | 2025-12-18 | K=49 校準穩定，子時跨日修正，12/12 回歸通過 |
